<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ubicación en tiempo real - Firebase + Mapbox</title>
 
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
 
  <style>
    body {
      margin: 0;
      font-family: "Poppins", Arial, sans-serif;
      background: #eef3f8;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
 
    h1 {
      background: linear-gradient(135deg, #0078A8, #00A8A8);
      color: white;
      padding: 15px 10px;
      margin: 0;
      width: 100%;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      font-size: 1.5em;
      letter-spacing: 1px;
    }
 
    #map {
      width: 90%;
      height: 500px;
      margin: 25px auto;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      border: 3px solid #0078A8;
      transition: transform 0.3s ease;
    }
 
    #map:hover {
      transform: scale(1.01);
    }
 
    #info {
      background: white;
      width: 85%;
      max-width: 600px;
      margin: 15px auto 30px;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      text-align: left;
      transition: box-shadow 0.3s ease;
    }
 
    #info:hover {
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }
 
    #info p {
      margin: 10px 0;
      font-size: 1em;
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid #f0f0f0;
      padding-bottom: 6px;
    }
 
    #info strong {
      color: #0078A8;
    }
 
    span {
      font-weight: 600;
      color: #444;
    }
 
    @media (max-width: 600px) {
      #map {
        height: 350px;
      }
      #info {
        width: 90%;
        padding: 15px;
      }
      h1 {
        font-size: 1.2em;
      }
    }
  </style>
</head>
<body>
<h1>Ubicación en tiempo real</h1>
<div id="map"></div>
<div id="info">
  <p><strong>ID:</strong> <span id="id">--</span></p>
  <p><strong>Latitud:</strong> <span id="lat">--</span></p>
  <p><strong>Longitud:</strong> <span id="lon">--</span></p>
  
</div>
 
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
 
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";
 
   const firebaseConfig = {
    apiKey: "AIzaSyCXn-GQ4K2gqaLwpMrtK_tSDDII204X9Hk",
    authDomain: "mapa-684b4.firebaseapp.com",
    projectId: "mapa-684b4",
    storageBucket: "mapa-684b4.firebasestorage.app",
    messagingSenderId: "1022457464337",
    appId: "1:1022457464337:web:4d3fc37564881207bb53b0",
    measurementId: "G-WEQ9JLK1L8"
  };

 
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
 
  mapboxgl.accessToken = 'pk.eyJ1IjoiamVzc2ljYWxhZnVlbnRlbCIsImEiOiJjbWhseHVndWQyOG1nMm1xMW1kMDZzNHdhIn0.tSJ9wotbIUT-r372rOWt2A';
 
  window.onload = () => {
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [-68.1193, -16.5000],
      zoom: 13
    });
    map.addControl(new mapboxgl.NavigationControl());
 
    let marker = null;
    const deviceId = "76e78ee43d8252b4";
    const ubicacionRef = ref(db, `Ubicaciones/${deviceId}`);
 
    onValue(ubicacionRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) return;
 
      const lat = parseFloat(data.latitud);
      const lon = parseFloat(data.longitud);
 
      if (!isNaN(lat) && !isNaN(lon)) {
        if (!marker) {
          marker = new mapboxgl.Marker({ color: 'red' }).setLngLat([lon, lat]).addTo(map);
          map.setCenter([lon, lat]);
        } else {
          marker.setLngLat([lon, lat]);
        }
 
        document.getElementById("id").textContent = data.idDispositivo || "Desconocido";
        document.getElementById("lat").textContent = lat.toFixed(5);
        document.getElementById("lon").textContent = lon.toFixed(5);
        document.getElementById("hora").textContent = data.hora || "--";
      }
    });
  };
</script>
</body>
</html>